<!DOCTYPE html>
<html data-framework="angularjs">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Maritime Message Information and Notices to Mariners</title>
    <link rel="icon" href="/img/favicon.ico" sizes="16x16 32x32 48x48 64x64" type="image/vnd.microsoft.icon">

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="css/app.css">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/select2/3.4.5/select2.css">
    <link rel="stylesheet" href="ext/select2-3.4.5/select2-bootstrap.css">

    <link rel="stylesheet" href="ext/bootstrap-datepicker/css/datepicker.css">
    <link rel="stylesheet" href="css/search.css">
    <link rel="stylesheet" href="css/site.css">

</head>
<body ng-app="msinm" ng-controller="SearchCtrl" ng-init="newSearch()">

<div ng-include="'partials/notifications.html'"></div>
<div ng-include="'partials/menu.html'"></div>

<!-- Location editor -->
<div class="location-editor">
    <div msi-location-editor locations="locations" edit-descs="false" visible="locationsVisible" style="width:100%; height: 100%">
        <div class="location-editor-panel">
            <div style="text-align: center;">
                <p>Select locations</p>
                <button href class="btn btn-primary btn-xs" ng-click="showLocationEditor(false)">Done</button>
            </div>
        </div>
    </div>
</div>


<div class="container-fluid"  style="overflow: visible;">

    <!-- Search result type menu bar -->
    <div class="row-fluid searchResultTypeBar visibleOnMap">
        <div class="input-group col-xs-12 col-sm-8 col-md-6 col-lg-6 center">
            <span class="searchResultTypeBtn" ng-click="go('/search/grid')" check-active="/search/grid">
                <span class="glyphicon glyphicon-th"></span> <span class="searchResultTypeText">Grid</span>
            </span>
            <span class="searchResultTypeBtn" ng-click="go('/search/details')" check-active="/search/details">
                <span class="glyphicon glyphicon-th-list"></span> <span class="searchResultTypeText">Details</span>
            </span>
            <span class="searchResultTypeBtn" ng-click="go('/search/table')" check-active="/search/table">
                <span class="glyphicon glyphicon-align-justify"></span> <span class="searchResultTypeText">Table</span>
            </span>
            <span class="searchResultTypeBtn" ng-click="go('/search/map')" check-active="/search/map">
                <span class="glyphicon glyphicon-globe"></span> <span class="searchResultTypeText">Map</span>
            </span>
        </div>
    </div>

    <form class="search-form form-horizontal" style="padding-top: 20px;" role="form" novalidate>
        <div class="input-group col-xs-12 col-sm-8 col-md-6 col-lg-6 center">


            <!-- Search field -->
            <div class="visibleOnMap" style="z-index: 300;">
                <div class="input-group">
                    <div class="input-group-btn">
                        <button type="submit" class="btn btn-primary" ng-click="newSearch()">
                            <span class="glyphicon glyphicon-search"></span> Search
                        </button>
                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" style="font-size: 12px;">
                            <li style="color: lightgray;">&nbsp;Filter by</li>
                            <li><a href ng-click="toggleFilterOnDate()">Date</a></li>
                            <li><a href ng-click="toggleFilterOnLocation()">Location</a></li>
                            <li><a href ng-click="toggleFilterOnType()">Type</a></li>
                            <li class="divider"></li>
                            <li><a href ng-click="pdf()">Generate PDF</a></li>
                        </ul>
                    </div>
                    <input id="query" type="text" class="form-control" placeholder="Search Terms" ng-model="query"
                           focus="focusMe"
                           data-content='Search using e.g. <code>+important</code>, <code>-excluded</code>, <code>par*ly</code> or <code>"exact match"</code>'
                           data-placement="bottom" data-html="true" data-trigger="hover">
                </div>
            </div>

            <!-- Date fields -->
            <div class="searchFilterPanel visibleOnMap" ng-show="filterOnDate">
                <div class="row">
                    <div class="col-xs-6 col-sm-5 col-md-4">
                        <input class="form-control input-sm" placeholder="From Date" type="text" value="" id="messageDateFrom" ng-model="dateFrom">
                    </div>
                    <div class="col-xs-6 col-sm-5 col-md-4">
                        <input class="form-control input-sm" placeholder="To Date" type="text" value="" id="messageDateTo" ng-model="dateTo">
                    </div>
                </div>

                <a ng-click="toggleFilterOnDate()" class="closeSearchFilterPanel"><i class="glyphicon glyphicon-minus-sign red"></i></a>
            </div>

            <!-- Location field -->
            <div class="searchFilterPanel visibleOnMap" ng-show="filterOnLocation">
                <div class="row">
                    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-5">
                        <input type="text" class="form-control input-sm" id="messageArea" ng-model="areas" />
                    </div>
                    <div class="col-xs-6 col-sm-6 col-md-5 btn-group">
                        <button href class="btn btn-default btn-sm" ng-click="showLocationEditor(true)">
                            <span class="glyphicon glyphicon-map-marker"></span> Edit locations
                        </button>
                        <button href class="btn btn-default btn-sm" ng-disabled="locations.length == 0" ng-click="resetLocation()">
                            <span class="glyphicon glyphicon-trash"></span>
                        </button>
                    </div>
                </div>

                <a ng-click="toggleFilterOnLocation()" class="closeSearchFilterPanel"><i class="glyphicon glyphicon-minus-sign red"></i></a>
            </div>

            <!-- Type fields -->
            <div class="searchFilterPanel visibleOnMap" ng-show="filterOnType">
                <div class="row">
                    <div class="select2-bootstrap-prepend col-sm-12">
                        <input type="radio" value="PUBLISHED" id="messageStatus" ng-model="status">&nbsp;Published &nbsp;
                        <input type="radio" value="DRAFT" ng-model="status">&nbsp;Draft &nbsp;
                        <input type="radio" value="EXPIRED" ng-model="status">&nbsp;Expired &nbsp;
                        <input type="radio" value="CANCELLED" ng-model="status">&nbsp;Cancelled &nbsp;
                        <input type="radio" value="DELETED" ng-model="status">&nbsp;Deleted &nbsp;
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12 col-sm-10 col-md-8 col-lg-6">
                        <select multiple class="form-control input-sm select2-multiple" id="messageType" ng-model="type">
                            <option></option>
                            <optgroup label="Notices to mariners">
                                <option value="PERMANENT_NOTICE">Permanent NtM</option>
                                <option value="TEMPORARY_NOTICE">Temporary NtM</option>
                                <option value="PRELIMINARY_NOTICE">Preliminary NtM</option>
                                <option value="MISCELLANEOUS_NOTICE">Miscellaneous NtM</option>
                            </optgroup>
                            <optgroup label="MSI">
                                <option value="COSTAL_WARNING">Coastal Warning</option>
                                <option value="SUBAREA_WARNING">Subarea Warning</option>
                                <option value="NAVAREA_WARNING">Navarea Warning</option>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <a ng-click="toggleFilterOnType()" class="closeSearchFilterPanel"><i class="glyphicon glyphicon-minus-sign red"></i></a>
            </div>


        </div>
    </form>


    <!-- Pagination -->
    <div class="row searchResultPagination visibleOnMap">
        <div class="col-sm-12">
            <pagination total-items="searchResult.total" items-per-page="pageSize" max-size="20"
                        ng-model="currentPage" ng-change="pageChanged()"
                        class="pagination pagination-sm"
                        previous-text="&lsaquo;"  next-text="&rsaquo;"
                        boundary-links="true" first-text="&laquo;" last-text="&raquo;">
            </pagination>
        </div>
    </div>

</div>

<div ng-view></div>



<!--script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script-->
<script src="ext/jquery-1.11.0/jquery-1.11.0.js" type="text/javascript"></script>

<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

<!--script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.6/angular.min.js"></script-->
<script src="ext/angularjs-1.2.10/angular.js" type="text/javascript"></script>
<script src="ext/angularjs-1.2.10/angular-route.js" type="text/javascript"></script>
<script src="ext/angularjs-1.2.10/angular-sanitize.js" type="text/javascript"></script>
<script src="ext/angularjs-1.2.10/cookies.js" type="text/javascript"></script>
<script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.11.0.js"></script>

<script src="ext/select2-3.4.5/select2.js" type="text/javascript"></script>
<script src="ext/bootstrap-datepicker/js/bootstrap-datepicker.js" type="text/javascript"></script>

<script src="ext/angular-file-upload-0.5.7/angular-file-upload.js"></script>
<script src="ext/angular-translate-2.2.0/angular-translate.min.js" type="text/javascript"></script>
<script src="ext/angular-growl-notifications-0.7.0/growl-notifications.min.js" type="text/javascript"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/openlayers/2.13.1/OpenLayers.js"></script>
<script src="//maps.google.com/maps/api/js?v=3&amp;sensor=false"></script>

<script src="js/search-app.js" type="text/javascript"></script>
<script src="js/conf/site-config.js" type="text/javascript"></script>
<script src="js/conf/site-texts.js" type="text/javascript"></script>
<script src="js/conf/base-layers.js" type="text/javascript"></script>
<script src="js/common/util.js" type="text/javascript"></script>
<script src="js/common/common-directives.js" type="text/javascript"></script>
<script src="js/common/common-ctrl.js" type="text/javascript"></script>
<script src="js/common/common-service.js" type="text/javascript"></script>
<script src="js/common/common-filters.js" type="text/javascript"></script>
<script src="js/search/search-ctrl.js" type="text/javascript"></script>
<script src="js/search/search-service.js" type="text/javascript"></script>
<script src="js/map/map-service.js" type="text/javascript"></script>
<script src="js/map/location-editor-directive.js" type="text/javascript"></script>
<script src="js/map/search-result-map-directive.js" type="text/javascript"></script>
<script src="js/map/position.js" type="text/javascript"></script>
<script src="js/user/user-ctrl.js" type="text/javascript"></script>
<script src="js/user/user-service.js" type="text/javascript"></script>

<script>
    function formatParentAreas(area) {
        var txt = undefined;
        if (area) {
            txt = (area.descs && area.descs.length > 0) ? area.descs[0].name : 'N/A';
            if (area.parent) {
                txt = formatParentAreas(area.parent) + " - " + txt;
            }
        }
        return txt;
    }

    $(document).ready(function() {
        $("#messageType").select2({
            placeholder: "Select Type",
            allowClear: true
        });
        $("#messageArea").select2({
            placeholder: "Select Areas",
            multiple: true,
            allowClear: true,
            minimumInputLength: 1,
            type: "GET",
            quietMillis: 50,
            ajax: {
                url: "/rest/admin/areas/search",
                dataType: 'json',
                data: function (term, page) {
                    return {
                        term: term,
                        lang: getLang("en"),
                        limit: 10
                    };
                },
                results: function (data, page) {
                    var results = [];
                    for (i in data) {
                        var area = data[i];
                        results.push({
                            id: area.id,
                            text: area.descs[0].name,
                            parent: formatParentAreas(area.parent)
                        });
                    }
                    return { results: results };
                }
            },
            formatResult: function (data, term) {
                var txt = "<strong>" + data.text + "</strong>";
                if (data.parent) {
                    txt = txt + " <small>(" + data.parent + ")</small>";
                }
                return txt;
            }
        });

        $("#messageDateFrom").datepicker({ format: "dd-mm-yyyy" });
        $("#messageDateTo").datepicker({ format: "dd-mm-yyyy" });
        $('#query').popover();
    });
</script>

</body>
</html>